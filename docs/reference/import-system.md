# Import System

husako uses a custom module resolver.

The supported import specifiers are different from Node.js.

## Supported specifiers

| Specifier pattern | Resolves to |
|-------------------|-------------|
| `"husako"` | Built-in husako SDK (metadata, quantities, build) |
| `"husako/_base"` | Base builder classes (_ResourceBuilder, _SchemaBuilder) |
| `"k8s/<group>/<version>"` | Generated builders for a k8s API group/version |
| `"k8s/_common"` | Generated common type builders (LabelSelector, etc.) |
| `"helm/<chart-name>"` | Generated Helm chart value builders |
| `"<plugin-name>"` | Plugin default module |
| `"<plugin-name>/<sub>"` | Plugin sub-module |
| `"./path"` or `"../path"` | Relative imports within the project |

---

## "husako" module

The `"husako"` module has a **default export only**:

```typescript
import husako from "husako";

husako.build([resource1, resource2]);
```

Named imports from `"husako"` are not supported. Chain starter functions (`name`, `cpu`, `memory`, `requests`, etc.) and resource factories (`Deployment`, `Service`, etc.) come from `"k8s/*"` modules instead.

```typescript
import { name, namespace, label } from "k8s/meta/v1";         // ObjectMeta starters
import { name, image, cpu, memory, requests } from "k8s/core/v1"; // Container starters
```

---

## "k8s/\<group>/\<version>"

Generated by `husako gen`.

Each file exports resource builder factories and chain starter functions for that API group:

```typescript
// Resource builders (PascalCase factories)
import { Deployment, ReplicaSet } from "k8s/apps/v1";
import { Service, ConfigMap, ServiceAccount } from "k8s/core/v1";
import { Ingress } from "k8s/networking.k8s.io/v1";
import { CronJob } from "k8s/batch/v1";

// Chain starter functions — create typed field fragments
import { name, namespace, label } from "k8s/meta/v1";           // ObjectMeta fields
import { name, image, cpu, memory, requests } from "k8s/core/v1"; // Container fields
```

The group and version come from the Kubernetes API path.

For core resources (`/api/v1`), use `k8s/core/v1`.

`.husako` files may import the same name from multiple `k8s/*` modules without aliasing. The husako LSP suppresses the TypeScript duplicate identifier warning for this pattern.

---

## "k8s/\_common"

Contains cross-resource type builders generated from `io.k8s.apimachinery.*` schemas:

```typescript
import { LabelSelector, ObjectMeta } from "k8s/_common";

const selector = LabelSelector().matchLabels({ app: "web" });
```

---

## "helm/\<chart-name>"

Generated by `husako gen` when chart dependencies are configured.

Exports typed value builders for that chart:

```typescript
import { IngressNginx } from "helm/ingress-nginx";

const nginxValues = IngressNginx()
  .replicaCount(2)
  .controller({ service: { type: "LoadBalancer" } });
```

The chart name comes from the key in `husako.toml [charts]`.

---

## Plugin modules

Plugins declare module mappings in their `plugin.toml`.

After `husako gen` installs the plugins, their modules are importable by their declared specifiers:

```typescript
// If a plugin named "flux" declares module "flux" → modules/index.js
import { HelmRelease, Kustomization } from "flux";

// If it also declares "flux/source" → modules/source.js
import { GitRepository, HelmRepository } from "flux/source";
```

See [Plugins](/advanced/plugins) for how plugins are installed and how to author them.

---

## Relative imports

Standard relative imports work within the project root:

```typescript
import { webDeployment } from "./deployments/web";
import { sharedMeta } from "../lib/metadata";
```

By default, resolved paths must stay within the project root (the directory containing `husako.toml`).

Use `--allow-outside-root` to override this:

```
husako render entry.husako --allow-outside-root
```

---

## Not supported

The following are not supported and will cause a runtime error:

- **npm/bare specifiers** — `import React from "react"` — husako has no npm registry resolver
- **Node.js built-ins** — `import fs from "node:fs"` — not available in QuickJS
- **Network imports** — `import ... from "https://..."` — no network access at render time

husako runs entirely offline after `husako gen`.

All dependencies must be local or declared in `husako.toml`.
