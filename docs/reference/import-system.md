# Import System

husako uses a custom module resolver.

The supported import specifiers are different from Node.js.

## Supported specifiers

| Specifier pattern | Resolves to |
|-------------------|-------------|
| `"husako"` | Built-in husako SDK (metadata, quantities, build) |
| `"husako/_base"` | Base builder classes (_ResourceBuilder, _SchemaBuilder) |
| `"k8s/<group>/<version>"` | Generated builders for a k8s API group/version |
| `"k8s/_common"` | Generated common type builders (LabelSelector, etc.) |
| `"helm/<chart-name>"` | Generated Helm chart value builders |
| `"<plugin-name>"` | Plugin default module |
| `"<plugin-name>/<sub>"` | Plugin sub-module |
| `"./path"` or `"../path"` | Relative imports within the project |

---

## "husako" module

The built-in `"husako"` module exports:

```typescript
import {
  // Core
  build,        // Required: submit resources for output
  merge,        // Merge fragment arrays

  // Metadata
  metadata,     // MetadataFragment factory
  name,         // Shorthand: metadata().name(v)
  namespace,    // Shorthand: metadata().namespace(v)
  label,        // Shorthand: metadata().label(k, v)
  annotation,   // Shorthand: metadata().annotation(k, v)

  // Resource quantities
  cpu,          // CPU quantity fragment
  memory,       // Memory quantity fragment
  requests,     // ResourceRequirements: requests
  limits,       // ResourceRequirements: limits
} from "husako";
```

---

## "k8s/\<group>/\<version>"

Generated by `husako generate`.

Each file exports builder factories for every resource kind in that API group and version:

```typescript
import { Deployment, ReplicaSet } from "k8s/apps/v1";
import { Pod, Service, ConfigMap, ServiceAccount } from "k8s/core/v1";
import { Ingress } from "k8s/networking.k8s.io/v1";
import { CronJob } from "k8s/batch/v1";
```

The group and version come from the Kubernetes API path.

For core resources (`/api/v1`), use `k8s/core/v1`.

---

## "k8s/\_common"

Contains cross-resource type builders generated from `io.k8s.apimachinery.*` schemas:

```typescript
import { LabelSelector, ObjectMeta } from "k8s/_common";

const selector = LabelSelector().matchLabels({ app: "web" });
```

---

## "helm/\<chart-name>"

Generated by `husako generate` when chart dependencies are configured.

Exports typed value builders for that chart:

```typescript
import { IngressNginx } from "helm/ingress-nginx";

const nginxValues = IngressNginx()
  .replicaCount(2)
  .controller({ service: { type: "LoadBalancer" } });
```

The chart name comes from the key in `husako.toml [charts]`.

---

## Plugin modules

Plugins declare module mappings in their `plugin.toml`.

After `husako generate` installs the plugins, their modules are importable by their declared specifiers:

```typescript
// If a plugin named "flux" declares module "flux" → modules/index.js
import { HelmRelease, Kustomization } from "flux";

// If it also declares "flux/source" → modules/source.js
import { GitRepository, HelmRepository } from "flux/source";
```

See [Plugins](/advanced/plugins) for how plugins are installed and how to author them.

---

## Relative imports

Standard relative imports work within the project root:

```typescript
import { webDeployment } from "./deployments/web";
import { sharedMeta } from "../lib/metadata";
```

By default, resolved paths must stay within the project root (the directory containing `husako.toml`).

Use `--allow-outside-root` to override this:

```
husako render entry.ts --allow-outside-root
```

---

## Not supported

The following are not supported and will cause a runtime error:

- **npm/bare specifiers** — `import React from "react"` — husako has no npm registry resolver
- **Node.js built-ins** — `import fs from "node:fs"` — not available in QuickJS
- **Network imports** — `import ... from "https://..."` — no network access at render time

husako runs entirely offline after `husako generate`.

All dependencies must be local or declared in `husako.toml`.
