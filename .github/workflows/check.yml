# Auto-generated by gaji
# Do not edit manually - Edit workflows/check.ts instead
# Generated at: 2026-02-23T17:41:24Z

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v5
    - uses: dtolnay/rust-toolchain@stable
      with:
        components: clippy,rustfmt
    - uses: Swatinem/rust-cache@v2
    - name: Format check
      run: cargo fmt --all --check
    - name: Clippy
      run: cargo clippy --workspace --all-targets --all-features -- -D warnings
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v5
    - uses: dtolnay/rust-toolchain@stable
    - uses: Swatinem/rust-cache@v2
    - name: Run tests
      run: cargo test --workspace --all-features
  e2e:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v5
    - uses: dtolnay/rust-toolchain@stable
    - uses: Swatinem/rust-cache@v2
    - name: Cache husako downloads (Scenario A)
      uses: actions/cache@v4
      with:
        path: test/e2e/.husako/cache
        key: ${{ runner.os }}-husako-e2e-${{ hashFiles('test/e2e/husako.toml') }}
    - name: Install kubectl
      run: |
        curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
        chmod +x kubectl && sudo mv kubectl /usr/local/bin/kubectl
    - name: Build husako binary
      run: cargo build --release --bin husako
    - name: E2E tests
      run: bash scripts/e2e.sh
name: Check
on:
  pull_request:
    branches:
    - master
  push:
    branches:
    - master
